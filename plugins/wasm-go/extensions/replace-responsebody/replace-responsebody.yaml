apiVersion: extensions.istio.io/v1alpha1
kind: WasmPlugin
metadata:
  name: replace-responsebody
  namespace: higress-system
spec:
  selector:
    matchLabels:
      higress: higress-system-higress-gateway
  pluginConfig:
    rules:
    - match:
        statuscode: "403"
        responsebody: "RBAC: access denied"
        replace:
          statuscode: "401"
          responsebody: "{\"code\":401,\"message\":\"User is not authenticated\"}"
          responseheader: 
            - content-type:  "application/json"
    - match:
        statuscode: "503"
        responsebody: "no healthy upstream"
        replace:
          statuscode: "404"
          responsebody: "{\"code\":503,\"message\":\"No Healthy Service\"}"
          responseheader:
            - content-type:  "application/json;charset=UTF-8"
            - content-language: "zh-CN"
  url: oci://docker.io/zhangjiahaol/envoy-plugin:replace-responsebody-1.0.0

