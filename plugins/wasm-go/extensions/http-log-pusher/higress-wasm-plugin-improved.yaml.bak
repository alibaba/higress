apiVersion: extensions.higress.io/v1alpha1
kind: WasmPlugin
metadata:
  name: http-log-push-plugin
  namespace: ls-test
  annotations:
    higress.io/redeploy-timestamp: "20260209-165237"
    higress.io/comment: "HTTP Log Push Plugin for collecting request logs"
    higress.io/wasm-plugin-title: "HTTP Log Push"
    higress.io/wasm-plugin-description: "Push HTTP request logs to external collector"
  labels:
    higress.io/wasm-plugin-name: http-log-push
    higress.io/wasm-plugin-category: logging
spec:
  url: https://pysrc-test.oss-cn-beijing.aliyuncs.com/higress-plugin/plugin-20260209-163659.wasm
  sha256: ""  # 建议填入WASM文件的SHA256校验和
  defaultConfigDisable: true  # 默认关闭全局配置
  failStrategy: FAIL_OPEN      # 失败时放行，避免影响业务
  imagePullPolicy: Always  # 总是拉取最新版本
  phase: STATS           # 插件执行阶段，用于统计和日志收集
  priority: 100               # 优先级
  # 匹配规则：应用到所有服务
  matchRules:
    - configDisable: false
      ingress:
        - model-api-eliot-test-text-0
        - travel-assistant
      config:
        log_level: info  # 必须在这里配置 log_level
        collector_host: "log-collector.higress-system.svc.cluster.local"
        collector_service_name: "log-collector"
        collector_port: 80
        collector_path: "/ingest"