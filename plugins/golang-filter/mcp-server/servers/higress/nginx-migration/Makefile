.PHONY: all standalone integration clean test help

# é»˜è®¤ç›®æ ‡
all: standalone

# ç¼–è¯‘ç‹¬ç«‹æ¨¡å¼
standalone:
	@echo "ğŸ”¨ ç¼–è¯‘ç‹¬ç«‹æ¨¡å¼..."
	@cd cmd/standalone && go build -o ../../nginx-migration-mcp
	@echo "âœ… ç‹¬ç«‹æ¨¡å¼ç¼–è¯‘å®Œæˆ: ./nginx-migration-mcp"

# æ¸…ç†ç¼–è¯‘äº§ç‰©
clean:
	@echo "ğŸ§¹ æ¸…ç†ç¼–è¯‘äº§ç‰©..."
	@rm -f nginx-migration-mcp
	@echo "âœ… æ¸…ç†å®Œæˆ"

# è¿è¡Œæµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	@go test ./...
	@echo "âœ… æµ‹è¯•å®Œæˆ"

# æµ‹è¯•ç‹¬ç«‹æ¨¡å¼
test-standalone: standalone
	@echo "ğŸ§ª æµ‹è¯•ç‹¬ç«‹æ¨¡å¼..."
	@echo '{"jsonrpc":"2.0","id":1,"method":"initialize","params":{}}' | timeout 2 ./nginx-migration-mcp
	@echo ""
	@echo "âœ… ç‹¬ç«‹æ¨¡å¼æµ‹è¯•å®Œæˆ"

# å®‰è£…ä¾èµ–
deps:
	@echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
	@go mod tidy
	@echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

# æ ¼å¼åŒ–ä»£ç 
fmt:
	@echo "ğŸ’… æ ¼å¼åŒ–ä»£ç ..."
	@go fmt ./...
	@echo "âœ… ä»£ç æ ¼å¼åŒ–å®Œæˆ"

# æ˜¾ç¤ºå¸®åŠ©
help:
	@echo "Nginx Migration MCP Server - Makefile"
	@echo ""
	@echo "å¯ç”¨ç›®æ ‡:"
	@echo "  make                  - ç¼–è¯‘ç‹¬ç«‹æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰"
	@echo "  make standalone       - ç¼–è¯‘ç‹¬ç«‹æ¨¡å¼"
	@echo "  make test             - è¿è¡Œæµ‹è¯•"
	@echo "  make test-standalone  - æµ‹è¯•ç‹¬ç«‹æ¨¡å¼"
	@echo "  make clean            - æ¸…ç†ç¼–è¯‘äº§ç‰©"
	@echo "  make deps             - å®‰è£…ä¾èµ–"
	@echo "  make fmt              - æ ¼å¼åŒ–ä»£ç "
	@echo "  make help             - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"
	@echo ""
	@echo "ç›®å½•ç»“æ„:"
	@echo "  cmd/standalone/       - ç‹¬ç«‹æ¨¡å¼å…¥å£"
	@echo "  internal/standalone/  - ç‹¬ç«‹æ¨¡å¼å®ç°"
	@echo "  integration/          - Higress MCP æ¡†æ¶é›†æˆ"
	@echo "  tools/                - å…±äº«æ ¸å¿ƒé€»è¾‘"

