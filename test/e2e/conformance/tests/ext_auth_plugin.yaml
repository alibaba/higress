apiVersion: extensions.higress.io/v1alpha1
kind: WasmPlugin
metadata:
  name: ext-auth
  namespace: higress-system
spec:
  defaultConfig:
    endpoint_mode: forward_auth
    endpoint: http://ext-auth-server.higress-conformance-infra.svc.cluster.local:8000
    mode: blacklist
    paths:
    - /blocked-path
    method_blacklist:
    - method: POST
      paths:
      - /api
    # Add timeout and retry configuration
    timeout: 30s
    retries: 3
  matchRules:
  - ingress:
    - higress-conformance-infra/wasmplugin-ext-auth
  # Add plugin phase and priority for proper execution order
  phase: AUTHN
  priority: 100