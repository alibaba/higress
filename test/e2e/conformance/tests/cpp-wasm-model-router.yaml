apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: wasmplugin-model-router-provider
  namespace: higress-conformance-ai-backend
spec:
  ingressClassName: higress
  rules:
    - host: "foo.com"
      http:
        paths:
          - pathType: Prefix
            path: "/"
            backend:
              service:
                name: llm-mock-service
                port:
                  number: 3000
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: wasmplugin-model-router-header
  namespace: higress-conformance-ai-backend
spec:
  ingressClassName: higress
  rules:
    - host: "foo.com"
      http:
        paths:
          - pathType: Prefix
            path: "/"
            backend:
              service:
                name: llm-mock-service
                port:
                  number: 3000
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: wasmplugin-model-router-custom-key
  namespace: higress-conformance-ai-backend
spec:
  ingressClassName: higress
  rules:
    - host: "foo.com"
      http:
        paths:
          - pathType: Prefix
            path: "/"
            backend:
              service:
                name: llm-mock-service
                port:
                  number: 3000
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: wasmplugin-model-router-path
  namespace: higress-conformance-ai-backend
spec:
  ingressClassName: higress
  rules:
    - host: "model-router-path.example.com"
      http:
        paths:
          - pathType: Prefix
            path: "/"
            backend:
              service:
                name: llm-mock-service
                port:
                  number: 3000
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: wasmplugin-model-router-combined
  namespace: higress-conformance-ai-backend
spec:
  ingressClassName: higress
  rules:
    - host: "foo.com"
      http:
        paths:
          - pathType: Prefix
            path: "/"
            backend:
              service:
                name: llm-mock-service
                port:
                  number: 3000
---
apiVersion: extensions.higress.io/v1alpha1
kind: WasmPlugin
metadata:
  name: model-router
  namespace: higress-system
spec:
  defaultConfigDisable: true
  phase: UNSPECIFIED_PHASE
  priority: 100
  matchRules:
    # 配置 1: 添加 provider 头  
    - config:
        addProviderHeader: "x-higress-llm-provider"
      ingress:
        - higress-conformance-ai-backend/wasmplugin-model-router-provider
    # 配置 2: 添加 model 头  
    - config:
        modelToHeader: "x-higress-llm-model"
      ingress:
        - higress-conformance-ai-backend/wasmplugin-model-router-header
    # 配置 3: 自定义 modelKey  
    - config:
        modelKey: "engine"
        addProviderHeader: "x-higress-llm-provider"
      ingress:
        - higress-conformance-ai-backend/wasmplugin-model-router-custom-key
    # 配置 4: 路径匹配  
    - config:
        modelToHeader: "x-higress-llm-model"
        enableOnPathSuffix: ["/v1/embeddings", "/v1/chat/completions"]
      ingress:
        - higress-conformance-ai-backend/wasmplugin-model-router-path
    # 配置 5: 复合功能  
    - config:
        addProviderHeader: "x-higress-llm-provider"
        modelToHeader: "x-higress-llm-model"
      ingress:
        - higress-conformance-ai-backend/wasmplugin-model-router-combined