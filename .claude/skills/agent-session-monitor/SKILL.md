---
name: agent-session-monitor
description: å®æ—¶Agentå¯¹è¯è§‚æµ‹ç¨‹åº - ç›‘æ§Higressè®¿é—®æ—¥å¿—ï¼ŒæŒ‰sessionèšåˆå¯¹è¯ï¼Œè¿½è¸ªtokenå¼€é”€ã€‚æ”¯æŒWebç•Œé¢å®æ—¶æŸ¥çœ‹å½“å‰ä¼šè¯çš„å®Œæ•´å¯¹è¯è¿‡ç¨‹å’Œå…·ä½“å¼€é”€ã€‚å½“ç”¨æˆ·è¯¢é—®å½“å‰ä¼šè¯tokenæ¶ˆè€—ã€å¯¹è¯å†å²ã€æˆæœ¬ç»Ÿè®¡æ—¶ä½¿ç”¨ã€‚

---

## åŠŸèƒ½æ¦‚è¿°

å®æ—¶ç›‘æ§Higressè®¿é—®æ—¥å¿—ï¼Œæå–ai_log JSONï¼ŒæŒ‰session_idåˆ†ç»„å¤šè½®å¯¹è¯ï¼Œå®æ—¶è®¡ç®—tokenå¼€é”€å¹¶ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Šã€‚æ”¯æŒé¢„ç®—é¢„è­¦å’Œæ¨¡å‹åˆ‡æ¢å»ºè®®ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **å®æ—¶æ—¥å¿—ç›‘æ§**ï¼šç›‘æ§Higressè®¿é—®æ—¥å¿—æ–‡ä»¶ï¼Œå®æ—¶è§£ææ–°å¢çš„ai_log
- **æ—¥å¿—è½®è½¬æ”¯æŒ**ï¼šå®Œå…¨æ”¯æŒlogrotateè½®è½¬ï¼Œè‡ªåŠ¨è¿½è¸ªaccess.log.1~5ç­‰æ–‡ä»¶
- **å¢é‡è§£æ**ï¼šåŸºäºinodeè¿½è¸ªï¼Œåªå¤„ç†æ–°å¢å†…å®¹ï¼Œä¸é‡å¤è§£æ
- **Sessionåˆ†ç»„**ï¼šæŒ‰session_idå…³è”å¤šè½®å¯¹è¯ï¼ˆæ¯æ¬¡å¯¹è¯æ˜¯ç‹¬ç«‹è¯·æ±‚ï¼‰
- **å®Œæ•´å¯¹è¯è¿½è¸ª**ï¼šè®°å½•æ¯è½®çš„messagesã€questionã€answerã€reasoningã€tool_calls
- **Tokenå¼€é”€è¿½è¸ª**ï¼šåŒºåˆ†è¾“å…¥tokenã€è¾“å‡ºtokenã€reasoning tokenã€ç¼“å­˜token
- **Webå¯è§†åŒ–ç•Œé¢**ï¼šæµè§ˆå™¨è®¿é—®ï¼Œæ€»è§ˆ+ä¸‹é’»æŸ¥çœ‹sessionè¯¦æƒ…
- **å®æ—¶URLç”Ÿæˆ**ï¼šClawdbotå¯æ ¹æ®å½“å‰ä¼šè¯IDç”Ÿæˆè§‚æµ‹é“¾æ¥
- **åå°è¿è¡Œ**ï¼šç‹¬ç«‹è¿›ç¨‹ï¼ŒæŒç»­è§£æè®¿é—®æ—¥å¿—
- **çŠ¶æ€æŒä¹…åŒ–**ï¼šè·¨è¿è¡Œä¿æŒè§£æè¿›åº¦å’Œsessionæ•°æ®

## ä½¿ç”¨æ–¹æ³•

### 1. åå°ç›‘æ§ï¼ˆæŒç»­è¿è¡Œï¼‰

```bash
# è§£æHigressè®¿é—®æ—¥å¿—ï¼ˆæ”¯æŒæ—¥å¿—è½®è½¬ï¼‰
python3 main.py --log-path /var/log/proxy/access.log --output-dir ./sessions

# æŒ‡å®šè½®è½¬æ–‡ä»¶æ•°é‡
python3 main.py --log-path /var/log/proxy/access.log --max-rotate 5

# æŒ‡å®šsession keyè¿‡æ»¤
python3 main.py --log-path /var/log/proxy/access.log --session-key <session-id>

# å®šæ—¶ä»»åŠ¡ï¼ˆæ¯åˆ†é’Ÿå¢é‡è§£æï¼‰
* * * * * python3 /path/to/main.py --log-path /var/log/proxy/access.log --output-dir /var/lib/sessions
```

**æ—¥å¿—è½®è½¬è¯´æ˜**ï¼š
- è‡ªåŠ¨æ‰«æ `access.log`, `access.log.1`, `access.log.2` ç­‰è½®è½¬æ–‡ä»¶
- ä½¿ç”¨inodeè¿½è¸ªæ–‡ä»¶ï¼Œå³ä½¿æ–‡ä»¶è¢«é‡å‘½åä¹Ÿèƒ½æ­£ç¡®è¯†åˆ«
- çŠ¶æ€æŒä¹…åŒ–ï¼Œé¿å…é‡å¤è§£æ
- Sessionæ•°æ®ç´¯ç§¯ï¼Œæ­£ç¡®ç»Ÿè®¡è·¨å¤šæ¬¡è¿è¡Œçš„tokenå¼€é”€

è¯¦è§ï¼š[LOG_ROTATION.md](LOG_ROTATION.md)

### 2. å¯åŠ¨Webç•Œé¢ï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨WebæœåŠ¡å™¨
python3 scripts/webserver.py --data-dir ./sessions --port 8888

# æµè§ˆå™¨è®¿é—®
open http://localhost:8888
```

Webç•Œé¢åŠŸèƒ½ï¼š
- ğŸ“Š æ€»è§ˆé¡µé¢ï¼šæŸ¥çœ‹æ‰€æœ‰sessionç»Ÿè®¡ã€æŒ‰æ¨¡å‹åˆ†ç»„
- ğŸ” Sessionè¯¦æƒ…ï¼šç‚¹å‡»session IDä¸‹é’»æŸ¥çœ‹å®Œæ•´å¯¹è¯å†å²
- ğŸ’¬ å¯¹è¯è®°å½•ï¼šæ˜¾ç¤ºæ¯è½®çš„messagesã€questionã€answerã€reasoningã€tool_calls
- ğŸ’° æˆæœ¬ç»Ÿè®¡ï¼šå®æ—¶è®¡ç®—tokenå¼€é”€å’Œæˆæœ¬
- ğŸ”„ è‡ªåŠ¨åˆ·æ–°ï¼šæ¯30ç§’è‡ªåŠ¨æ›´æ–°æ•°æ®

### 3. åœ¨Clawdbotå¯¹è¯ä¸­ä½¿ç”¨

å½“ç”¨æˆ·è¯¢é—®å½“å‰ä¼šè¯çš„tokenæ¶ˆè€—æˆ–å¯¹è¯å†å²æ—¶ï¼Œä½ å¯ä»¥ï¼š

1. è·å–å½“å‰ä¼šè¯çš„session_idï¼ˆä»runtimeæˆ–contextä¸­ï¼‰
2. ç”ŸæˆWebç•Œé¢URLå¹¶è¿”å›ç»™ç”¨æˆ·

ç¤ºä¾‹å›å¤ï¼š

```
ä½ çš„å½“å‰ä¼šè¯ç»Ÿè®¡ï¼š
- Session ID: agent:main:discord:channel:1465367993012981988
- æŸ¥çœ‹è¯¦æƒ…ï¼šhttp://localhost:8888/session?id=agent:main:discord:channel:1465367993012981988

ç‚¹å‡»é“¾æ¥å¯ä»¥çœ‹åˆ°ï¼š
âœ… å®Œæ•´çš„å¯¹è¯å†å²
âœ… æ¯è½®tokenæ¶ˆè€—æ˜ç»†
âœ… å·¥å…·è°ƒç”¨è®°å½•
âœ… æˆæœ¬ç»Ÿè®¡
```

### 4. CLIæŸ¥è¯¢ï¼ˆå¯é€‰ï¼‰

```bash
# æŸ¥çœ‹ç‰¹å®šsessionè¯¦æƒ…
python3 scripts/cli.py show <session-id>

# åˆ—å‡ºæ‰€æœ‰session
python3 scripts/cli.py list --sort-by cost --limit 10

# æŒ‰æ¨¡å‹ç»Ÿè®¡
python3 scripts/cli.py stats-model

# æŒ‰æ—¥æœŸç»Ÿè®¡ï¼ˆæœ€è¿‘7å¤©ï¼‰
python3 scripts/cli.py stats-date --days 7

# å¯¼å‡ºæŠ¥è¡¨
python3 scripts/cli.py export finops-report.json
```

## é…ç½®å‚æ•°

### main.py (åå°ç›‘æ§)

| å‚æ•° | è¯´æ˜ | å¿…å¡« | é»˜è®¤å€¼ |
|------|------|--------|----------|
| `--log-path` | Higressè®¿é—®æ—¥å¿—æ–‡ä»¶è·¯å¾„ | æ˜¯ | /var/log/higress/access.log |
| `--output-dir` | sessionæ•°æ®å­˜å‚¨ç›®å½• | å¦ | ./sessions |
| `--session-key` | åªç›‘æ§æŒ‡å®šsession key | å¦ | ç›‘æ§æ‰€æœ‰session |
| `--max-rotate` | æœ€å¤§è½®è½¬æ–‡ä»¶æ•°é‡ | å¦ | 5 |
| `--state-file` | çŠ¶æ€æ–‡ä»¶è·¯å¾„ï¼ˆè®°å½•å·²è¯»offsetï¼‰ | å¦ | <output-dir>/.state.json |
| `--refresh-interval` | æ—¥å¿—åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰ | å¦ | 1 |

### webserver.py (Webç•Œé¢)

| å‚æ•° | è¯´æ˜ | å¿…å¡« | é»˜è®¤å€¼ |
|------|------|--------|----------|
| `--data-dir` | sessionæ•°æ®ç›®å½• | å¦ | ./sessions |
| `--port` | HTTPæœåŠ¡å™¨ç«¯å£ | å¦ | 8888 |
| `--host` | HTTPæœåŠ¡å™¨åœ°å€ | å¦ | 0.0.0.0 |

## è¾“å‡ºç¤ºä¾‹

### 1. å®æ—¶ç›‘æ§è¾“å‡º

```
ğŸ” Session Monitor - Active
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š Active Sessions: 3

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session ID   â”‚ Messages       â”‚ Input Tokens  â”‚ Output Tokens â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ sess_abc123  â”‚ 5              â”‚ 1250         â”‚ 800          â”‚
â”‚ sess_xyz789  â”‚ 3              â”‚ 890          â”‚ 650          â”‚
â”‚ sess_def456  â”‚ 8              â”‚ 2100         â”‚ 1200         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“ˆ Token Statistics
  Total Input:   4240 tokens
  Total Output:  2650 tokens
  Total Cached:  0 tokens
  Total Cost:    $0.00127

ğŸ¯ Budget: 6890 / 1000000 (0.7%)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### 2. CLIæŸ¥è¯¢sessionè¯¦æƒ…

```bash
$ python3 scripts/cli.py show agent:main:discord:channel:1465367993012981988

======================================================================
ğŸ“Š Session Detail: agent:main:discord:channel:1465367993012981988
======================================================================

ğŸ• Created:  2026-02-01T09:30:00+08:00
ğŸ•‘ Updated:  2026-02-01T10:35:12+08:00
ğŸ¤– Model:    Qwen3-rerank
ğŸ’¬ Messages: 5

ğŸ“ˆ Token Statistics:
   Input:           1,250 tokens
   Output:            800 tokens
   Reasoning:         150 tokens
   Total:           2,200 tokens

ğŸ’° Estimated Cost: $0.001260 USD

ğŸ“ Conversation Rounds (5):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Round 1 @ 2026-02-01T09:30:15+08:00
    Tokens: 250 in â†’ 160 out
    ğŸ”§ Tool calls: Yes
    Messages (2):
      [user] æŸ¥è¯¢åŒ—äº¬å¤©æ°”
    â“ Question: æŸ¥è¯¢åŒ—äº¬å¤©æ°”
    âœ… Answer: æ­£åœ¨ä¸ºæ‚¨æŸ¥è¯¢åŒ—äº¬å¤©æ°”...
    ğŸ§  Reasoning: ç”¨æˆ·æƒ³çŸ¥é“åŒ—äº¬çš„å¤©æ°”ï¼Œæˆ‘éœ€è¦è°ƒç”¨å¤©æ°”æŸ¥è¯¢å·¥å…·ã€‚
    ğŸ› ï¸  Tool Calls:
       - get_weather({"location":"Beijing"})

  Round 2 @ 2026-02-01T09:32:00+08:00
    Tokens: 320 in â†’ 180 out
    Messages (1):
      [tool] {"temperature": 15, "weather": "æ™´"}
    âœ… Answer: åŒ—äº¬ä»Šå¤©å¤©æ°”æ™´æœ—ï¼Œæ¸©åº¦15Â°Cã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

======================================================================
```

### 3. æŒ‰æ¨¡å‹ç»Ÿè®¡

```bash
$ python3 scripts/cli.py stats-model

================================================================================
ğŸ“Š Statistics by Model
================================================================================

Model                Sessions   Input           Output          Cost (USD)  
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Qwen3-rerank         12         15,230          9,840           $  0.0168
DeepSeek-R1          5          8,450           6,200           $  0.0106
Qwen-Max             3          4,200           3,100           $  0.0083
GPT-4                2          2,100           1,800           $  0.0171
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL                22         29,980          20,940          $  0.0528

================================================================================
```

### 4. æŒ‰æ—¥æœŸç»Ÿè®¡

```bash
$ python3 scripts/cli.py stats-date --days 7

================================================================================
ğŸ“Š Statistics by Date (Last 7 days)
================================================================================

Date         Sessions   Input           Output          Cost (USD)   Models              
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2026-01-26   3          2,100           1,450           $  0.0042   Qwen3-rerank
2026-01-27   5          4,850           3,200           $  0.0096   Qwen3-rerank, GPT-4
2026-01-28   4          3,600           2,800           $  0.0078   DeepSeek-R1, Qwen
2026-01-29   6          7,200           5,100           $  0.0144   Qwen3-rerank +2
2026-01-30   2          5,400           3,900           $  0.0102   Qwen-Max
2026-01-31   1          4,200           3,100           $  0.0083   Qwen-Max
2026-02-01   1          2,630           1,390           $  0.0063   Qwen3-rerank
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL        22         29,980          20,940          $  0.0528

================================================================================
```

### 5. Webç•Œé¢ï¼ˆæ¨èï¼‰

è®¿é—® `http://localhost:8888` å¯ä»¥çœ‹åˆ°ï¼š

**é¦–é¡µï¼š**
- ğŸ“Š æ€»ä¼šè¯æ•°ã€æ€»Tokenæ¶ˆè€—ã€æ€»æˆæœ¬å¡ç‰‡
- ğŸ“‹ æœ€è¿‘ä¼šè¯åˆ—è¡¨ï¼ˆå¯ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ï¼‰
- ğŸ“ˆ æŒ‰æ¨¡å‹ç»Ÿè®¡è¡¨æ ¼

**Sessionè¯¦æƒ…é¡µï¼š**
- ğŸ’¬ å®Œæ•´å¯¹è¯è®°å½•ï¼ˆæ¯è½®çš„messagesã€questionã€answerã€reasoningã€tool_callsï¼‰
- ğŸ”§ å·¥å…·è°ƒç”¨å†å²
- ğŸ’° Tokenæ¶ˆè€—æ˜ç»†å’Œæˆæœ¬

**ç‰¹ç‚¹ï¼š**
- ğŸ”„ æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
- ğŸ“± å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯
- ğŸ¨ ä¼˜é›…çš„UIï¼Œæ˜“äºé˜…è¯»

## Sessionæ•°æ®ç»“æ„

æ¯ä¸ªsessionå­˜å‚¨ä¸ºç‹¬ç«‹JSONæ–‡ä»¶ï¼ŒåŒ…å«å®Œæ•´çš„å¯¹è¯å†å²å’Œtokenç»Ÿè®¡ï¼š

```json
{
  "session_id": "agent:main:discord:channel:1465367993012981988",
  "created_at": "2026-02-01T10:30:00Z",
  "updated_at": "2026-02-01T10:35:12Z",
  "messages_count": 5,
  "total_input_tokens": 1250,
  "total_output_tokens": 800,
  "total_reasoning_tokens": 150,
  "total_cached_tokens": 0,
  "model": "Qwen3-rerank",
  "rounds": [
    {
      "round": 1,
      "timestamp": "2026-02-01T10:30:15Z",
      "input_tokens": 250,
      "output_tokens": 160,
      "model": "Qwen3-rerank",
      "has_tool_calls": true,
      "response_type": "normal",
      "messages": [
        {
          "role": "system",
          "content": "You are a helpful assistant..."
        },
        {
          "role": "user",
          "content": "æŸ¥è¯¢åŒ—äº¬å¤©æ°”"
        }
      ],
      "question": "æŸ¥è¯¢åŒ—äº¬å¤©æ°”",
      "answer": "æ­£åœ¨ä¸ºæ‚¨æŸ¥è¯¢åŒ—äº¬å¤©æ°”...",
      "reasoning": "ç”¨æˆ·æƒ³çŸ¥é“åŒ—äº¬çš„å¤©æ°”ï¼Œæˆ‘éœ€è¦è°ƒç”¨å¤©æ°”æŸ¥è¯¢å·¥å…·ã€‚",
      "tool_calls": [
        {
          "index": 0,
          "id": "call_abc123",
          "type": "function",
          "function": {
            "name": "get_weather",
            "arguments": "{\"location\":\"Beijing\"}"
          }
        }
      ]
    },
    {
      "round": 2,
      "timestamp": "2026-02-01T10:32:00Z",
      "input_tokens": 320,
      "output_tokens": 180,
      "model": "Qwen3-rerank",
      "has_tool_calls": false,
      "response_type": "normal",
      "messages": [
        {
          "role": "tool",
          "content": "{\"temperature\": 15, \"weather\": \"æ™´\"}"
        }
      ],
      "question": "",
      "answer": "åŒ—äº¬ä»Šå¤©å¤©æ°”æ™´æœ—ï¼Œæ¸©åº¦15Â°Cã€‚",
      "reasoning": "",
      "tool_calls": []
    }
  ]
}
```

### å­—æ®µè¯´æ˜

**ä¼šè¯çº§åˆ«ï¼š**
- `session_id`: ä¼šè¯å”¯ä¸€æ ‡è¯†ï¼ˆæ¥è‡ªai_logçš„session_idå­—æ®µï¼‰
- `created_at`: ä¼šè¯åˆ›å»ºæ—¶é—´
- `updated_at`: æœ€åæ›´æ–°æ—¶é—´
- `messages_count`: å¯¹è¯è½®æ¬¡æ•°
- `total_input_tokens`: ç´¯è®¡è¾“å…¥token
- `total_output_tokens`: ç´¯è®¡è¾“å‡ºtoken
- `total_reasoning_tokens`: ç´¯è®¡reasoning tokenï¼ˆDeepSeekç­‰æ¨¡å‹ï¼‰
- `total_cached_tokens`: ç´¯è®¡ç¼“å­˜token
- `model`: å½“å‰ä½¿ç”¨çš„æ¨¡å‹

**è½®æ¬¡çº§åˆ«ï¼ˆroundsï¼‰ï¼š**
- `round`: è½®æ¬¡åºå·
- `timestamp`: å½“å‰è½®æ¬¡æ—¶é—´æˆ³
- `input_tokens`: å½“å‰è½®æ¬¡è¾“å…¥token
- `output_tokens`: å½“å‰è½®æ¬¡è¾“å‡ºtoken
- `model`: å½“å‰è½®æ¬¡ä½¿ç”¨çš„æ¨¡å‹
- `has_tool_calls`: æ˜¯å¦åŒ…å«å·¥å…·è°ƒç”¨
- `response_type`: å“åº”ç±»å‹ï¼ˆnormal/errorç­‰ï¼‰
- `messages`: å®Œæ•´çš„å¯¹è¯å†å²ï¼ˆOpenAI messagesæ ¼å¼ï¼‰
- `question`: å½“å‰è½®æ¬¡çš„ç”¨æˆ·é—®é¢˜ï¼ˆæœ€åä¸€æ¡ç”¨æˆ·æ¶ˆæ¯ï¼‰
- `answer`: å½“å‰è½®æ¬¡çš„AIå›ç­”
- `reasoning`: AIçš„æ€è€ƒè¿‡ç¨‹ï¼ˆå¦‚æœæ¨¡å‹æ”¯æŒï¼‰
- `tool_calls`: å·¥å…·è°ƒç”¨åˆ—è¡¨ï¼ˆå¦‚æœæœ‰ï¼‰

## FinOps Skillå°è£…

æœ¬ç¨‹åºå°†è¢«å°è£…ä¸ºHigressçš„FinOps skillï¼Œæä¾›ä»¥ä¸‹èƒ½åŠ›ï¼š

1. **Tokenæˆæœ¬åˆ†æ**ï¼šè¯¦ç»†çš„tokenä½¿ç”¨ç»Ÿè®¡å’Œæˆæœ¬è®¡ç®—
2. **Sessionè¶‹åŠ¿åˆ†æ**ï¼šå¤šè½®å¯¹è¯çš„å¢é•¿æ¨¡å¼è¯†åˆ«
3. **é¢„ç®—ç®¡ç†**ï¼šé¢„è®¾é¢„ç®—å’Œè¶…æ”¯é˜²æŠ¤
4. **æ¨¡å‹é€‰æ‹©ä¼˜åŒ–**ï¼šåŸºäºtokenä½¿ç”¨æƒ…å†µæ¨èæœ€ä¼˜æ¨¡å‹
5. **å®æ—¶ç›‘æ§é¢æ¿**ï¼šWebç•Œé¢æŸ¥çœ‹ä¼šè¯çŠ¶æ€

## å®ç°è¯´æ˜

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **æ—¥å¿—è§£æ**ï¼šä½¿ç”¨gjsonåº“è§£æai_log JSON
- **æ–‡ä»¶ç›‘æ§**ï¼šfsnotifyå®ç°æ—¥å¿—æ–‡ä»¶å˜æ›´æ£€æµ‹
- **Sessionç®¡ç†**ï¼šå†…å­˜+ç£ç›˜æ··åˆå­˜å‚¨ç­–ç•¥
- **Tokenè®¡ç®—**ï¼šæ”¯æŒGPT-4ã€Qwenã€Claudeç­‰å¤šç§æ¨¡å‹å®šä»·
- **å‘Šè­¦ç³»ç»Ÿ**ï¼šæ”¯æŒDiscordã€Slackã€Telegramç­‰å¤šç§æ¸ é“

### éšç§å’Œå®‰å…¨

- âœ… ä¸è®°å½•å¯¹è¯å†…å®¹ï¼Œä»…å­˜å‚¨tokenç»Ÿè®¡
- âœ… Sessionæ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¸Šä¼ åˆ°å¤–éƒ¨æœåŠ¡
- âœ… æ”¯æŒæ—¥å¿—æ–‡ä»¶è·¯å¾„ç™½åå•
- âœ… Session keyè®¿é—®æ§åˆ¶

### æ€§èƒ½ä¼˜åŒ–

- å¢é‡æ—¥å¿—è§£æï¼Œé¿å…å…¨é‡æ‰«æ
- å†…å­˜ä¸­çš„sessionæ•°æ®å®šæœŸæŒä¹…åŒ–
- æ—¥å¿—æ–‡ä»¶è¯»å–ä¼˜åŒ–ï¼ˆoffsetè¿½è¸ªï¼‰
